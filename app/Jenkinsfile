pipeline {
    agent any
    environment {
        REGISTRY = 'manuelbarrionuevo'
        DOCKER_HUB_LOGIN = credentials('docker')
        RESULT = '/app/result'
        VOTE = '/app/vote'
        WORKER = '/app/worker'
    }
        stage('Build') {
            parallel {
                stage('result') {
                    steps {
                        dir("$RESULT") {
                            sh '''
                                sudo docker build -t $REGISTRY/result:v1 .
                            '''
                        }
                    }
                }
                stage('vote') {
                    steps {
                        dir("$VOTE") {
                            sh '''
<<<<<<< HEAD
                                docker build -t $REGISTRY/vote:v1 .
                            '''
=======
                                  sudo  docker build -t $REGISTRY/vote:v1 .
                                '''
                            }
>>>>>>> parent of d69792b (saco sudo)
                        }
                    }
                }
                stage('worker') {
                    steps {
                        dir("$WORKER") {
<<<<<<< HEAD
                            sh '''
                                docker build -t $REGISTRY/worker:v1 .
                            '''
=======
                            sh  '''
                                 sudo  docker build -t $REGISTRY/worker:v1 .
                                '''
>>>>>>> parent of d69792b (saco sudo)
                        }
                    }
                }
            }
        }

        stage('deploy') {
            steps {
                sh '''
                    docker login --username=$DOCKER_HUB_LOGIN_USR --password=$DOCKER_HUB_LOGIN_PSW
                    docker push $REGISTRY/result:v1
                    docker push $REGISTRY/vote:v1
                    docker push $REGISTRY/worker:v1
                '''
            }
        }
    }
}
